<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Sample of websocket with golang</title>

        <script   src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>

        <script>
          function buildClient(selector) {
              return function() {
                  var ws = new WebSocket("ws://localhost:8080/echo");
                  var $ul = $('.msg-list', selector);
                  ws.onmessage = function(e) {
                    var data = JSON.parse(event.data)
                    console.log("received:", data);
                    $('<li>').text("received: " + data.data).appendTo($ul);
                  };
                  $('.sendBtn', selector).click(function(){
                    var data = $('.name', selector).val();
                    var to = $('.to', selector).val();
                    var msg = {to: to, data: data}
                    ws.send(JSON.stringify(msg));
                    console.log("sending:", msg);
                    $('<li>').text("sent: " + data).appendTo($ul);
                  });
              }
          }
          $(buildClient("#client1"));
          $(buildClient("#client2"));
        </script>
    </head>
    <body>
        <div id="client1" style="width: 300px; padding: 20px 10px; display: table-cell; border: 1px solid #aaa;">
            <ul class="msg-list"></ul>
            <input class="name" type="text" />
            to: <input class="to" type="text" value="2" />
            <input type="button" class="sendBtn" value="send"></input>
        </div>
        <div id="client2" style="width: 300px; padding: 20px 10px; display: table-cell; border: 1px solid #aaa;">
            <ul class="msg-list"></ul>
            <input class="name" type="text" />
            to: <input class="to" type="text" value="1" />
            <input type="button" class="sendBtn" value="send"></input>
        </div>
    </body>
</html>
